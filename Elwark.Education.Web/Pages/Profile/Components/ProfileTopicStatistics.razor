@* ReSharper disable once CheckNamespace *@
@namespace Elwark.Education.Web.Components

@using Elwark.Education.Web.Gateways.Models.Statistics
@inject IStringLocalizer<App> L

<div class="statistics-grid @Class">
    <div class="icon-widget-grid">
        <ProfileStatisticsIconWidget
            Icon="@Icons.Filled.Explore"
            Title="@L["Topics:InProgress"]"
            Value="@Statistics.TopicsState.InProgress.ToReadable()"/>

        <ProfileStatisticsIconWidget
            Icon="@Icons.Filled.ExploreOff"
            Title="@L["Topics:Completed"]"
            Value="@Statistics.TopicsState.Completed.ToReadable()"/>

        <ProfileStatisticsIconWidget
            Icon="@Icons.Filled.Timer"
            Title="@L["TimeSpent"]"
            Value="@Statistics.TimeSpent.ToSimpleFormat()">
            <Caption>
                <ProfileStatisticsDifferenceCaption
                    Current="@Statistics.WeeklyDifference.TimeSpent.Current"
                    Difference="@Statistics.WeeklyDifference.TimeSpent.Difference"
                    ValueConverter="@(span => span.ToSimpleFormat())"/>
            </Caption>
        </ProfileStatisticsIconWidget>
    </div>

    <ProfileStatisticsDetailWidget 
        Icon="@Icons.Filled.School"
        Value="@Statistics.CompletedTests.Total.ToReadable()" 
        Title="@L["CompletedTests"]">
        <Caption>
            <ProfileStatisticsDifferenceCaption
                Current="@Statistics.WeeklyDifference.CompletedTests.Current"
                Difference="@Statistics.WeeklyDifference.CompletedTests.Difference"
                ValueConverter="@(arg => arg.ToReadable())"/>
        </Caption>
        <Details>
            <div class="detail-grid">
                <div>
                    <MudText Typo="Typo.h6" Align="Align.Center">
                        @Statistics.CompletedTests.Completed.ToReadable()
                    </MudText>
                    <MudText Typo="Typo.body1" Align="Align.Center">
                        @L["CompletedTests:Completed"]
                    </MudText>
                </div>
                <div>
                    <MudText Typo="Typo.h6" Align="Align.Center">
                        @Statistics.CompletedTests.TimeExceeded.ToReadable()
                    </MudText>
                    <MudText Typo="Typo.body1" Align="Align.Center">
                        @L["CompletedTests:TimeExceeded"]
                    </MudText>
                </div>
                <div>
                    <MudText Typo="Typo.h6" Align="Align.Center">
                        @Statistics.CompletedTests.RepliesExceeded.ToReadable()
                    </MudText>
                    <MudText Typo="Typo.body1" Align="Align.Center">
                        @L["CompletedTests:RepliesExceeded"]
                    </MudText>
                </div>
            </div>
        </Details>
    </ProfileStatisticsDetailWidget>

    <ProfileStatisticsDetailWidget 
        Icon="@Icons.Filled.PendingActions" 
        Value="@Statistics.Score.Total.ToReadable()"
        Title="@L["Score"]">
        <Caption>
            <ProfileStatisticsDifferenceCaption
                Current="@Statistics.WeeklyDifference.Score.Current"
                Difference="@Statistics.WeeklyDifference.Score.Difference"
                ValueConverter="@(arg => arg.ToReadable())"/>
        </Caption>
        <Details>
            <div class="detail-grid">
                <div>
                    <MudText Typo="Typo.h6" Align="Align.Center">
                        @Statistics.Score.Questions.ToReadable()
                    </MudText>
                    <MudText Typo="Typo.body1" Align="Align.Center">
                        @L["Score:ByQuestions"]
                    </MudText>
                </div>
                <div>
                    <MudText Typo="Typo.h6" Align="Align.Center">
                        @Statistics.Score.NoMistakes.ToReadable()
                    </MudText>
                    <MudText Typo="Typo.body1" Align="Align.Center">
                        @L["Score:NoMistakesBonus"]
                    </MudText>
                </div>
                <div>
                    <MudText Typo="Typo.h6" Align="Align.Center">
                        @Statistics.Score.Speed.ToReadable()
                    </MudText>
                    <MudText Typo="Typo.body1" Align="Align.Center">
                        @L["Score:BySpeedBonus"]
                    </MudText>
                </div>
            </div>
        </Details>
    </ProfileStatisticsDetailWidget>

    <ProfileStatisticsDetailWidget 
        Icon="@Icons.Filled.HelpOutline" 
        Value="@Statistics.AnswerRatio.Questions.ToReadable()" 
        Title="@L["Questions"]">
        <Caption>
            <ProfileStatisticsDifferenceCaption
                Current="@Statistics.WeeklyDifference.Questions.Current"
                Difference="@Statistics.WeeklyDifference.Questions.Difference"
                ValueConverter="@(arg => arg.ToReadable())"/>
        </Caption>
        <Details>
            <div class="detail-grid">
                <div>
                    <MudText Typo="Typo.h6" Align="Align.Center">
                        @Statistics.AnswerRatio.Correct.ToReadable()
                    </MudText>
                    <MudText Typo="Typo.body1" Align="Align.Center">
                        @L["Questions:Correct"]
                    </MudText>
                </div>
                <div>
                    <MudText Typo="Typo.h6" Align="Align.Center">
                        @Statistics.AnswerRatio.Incorrect.ToReadable()
                    </MudText>
                    <MudText Typo="Typo.body1" Align="Align.Center">
                        @L["Questions:Incorrect"]
                    </MudText>
                </div>
                <div>
                    <MudText Typo="Typo.h6" Align="Align.Center">
                        @Statistics.AnswerRatio.Answered.ToReadable()
                    </MudText>
                    <MudText Typo="Typo.body1" Align="Align.Center">
                        @L["Questions:Answered"]
                    </MudText>
                </div>
                <div>
                    <MudText Typo="Typo.h6" Align="Align.Center">
                        @Statistics.AnswerRatio.NotAnswered.ToReadable()
                    </MudText>
                    <MudText Typo="Typo.body1" Align="Align.Center">
                        @L["Questions:NotAnswered"]
                    </MudText>
                </div>
            </div>
        </Details>
    </ProfileStatisticsDetailWidget>

    <ProfileStatisticsRankingWidget
        Title="@L["Ranking:ByScore"]"
        Items="@Statistics.ScoreRanking"
        LinkBuilder="@((string id) => LinkBuilder(id))"
        ValueConverter="@(arg => arg.ToReadable())"/>

    <ProfileStatisticsRankingWidget
        Title="@L["Ranking:ByTimeSpent"]"
        Items="@Statistics.TimeSpentRanking"
        LinkBuilder="@((string id) => LinkBuilder(id))"
        ValueConverter="@((TimeSpan item) => item.ToSimpleFormat())"/>

    <ProfileStatisticsRankingWidget
        Title="@L["Ranking:ByCompletedTimesRanking"]"
        Items="@Statistics.CompletedTimesRanking"
        LinkBuilder="@((string id) => LinkBuilder(id))"
        ValueConverter="@(arg => arg.ToReadable())"/>
</div>

@code {

    [Parameter]
    public TopicStatistics Statistics { get; set; } = default!;

    [Parameter]
    public string? Class { get; set; }

    [Parameter]
    public Func<string, string> LinkBuilder { get; set; } = _ => string.Empty;

}