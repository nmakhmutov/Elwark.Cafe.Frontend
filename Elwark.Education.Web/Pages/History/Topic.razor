@page "/history/topic/{id}"
@using Elwark.Education.Web.Gateways.History
@using Elwark.Education.Web.Gateways.Models.History
@inject IHistoryClient HistoryClient
@inject IStringLocalizer<App> L

@attribute [Authorize]
@switch (_topic.Status)
{
    case ResponseStatus.Loading:
        <PageLoader/>
        break;

    case ResponseStatus.Fail:
        <ErrorPage Error="_topic.Error"/>
        break;

    case ResponseStatus.Success:
        <Title Value="@_topic.Data.Title"/>
        @switch (_topic.Data)
        {
            case HistoryEventTopicDetail x:
                <HistoryEventTopicView Topic="@x" Breadcrumbs="@_breadcrumbs"/>
                break;

            case HistoryPersonTopicDetail x:
                <HistoryPersonTopicView Topic="@x" Breadcrumbs="@_breadcrumbs"/>
                break;
        }
        break;
}

@code {
    private ApiResponse<HistoryTopicDetail> _topic = ApiResponse<HistoryTopicDetail>.Loading();

    private BreadcrumbsItem[] _breadcrumbs = Array.Empty<BreadcrumbsItem>();

    [Parameter]
    public string Id { get; set; } = string.Empty;

    protected override async Task OnParametersSetAsync()
    {
        _topic = await HistoryClient.GetTopicAsync(Id);

        if (_topic.Status == ResponseStatus.Success)
            _breadcrumbs = new BreadcrumbsItem[]
            {
                new(L["History"].Value, Links.History.Index),
                new(_topic.Data.Period.Title, Links.History.Period(_topic.Data.Period.Type))
            };
    }

}