@* ReSharper disable once CheckNamespace *@
@namespace Elwark.Education.Web.Components

@using Elwark.Education.Web.Gateways.Models.History
@inject IStringLocalizer<App> L

@for (var i = 0; i < Articles.Length; i++)
{
    var article = Articles[i];
    <div class="article @(i % 2 == 0 ? "flex-md-row" : "flex-md-row-reverse")">
        <div class="image-container">
            <div class="image-background @(i % 2 == 0 ? "left" : "right")"></div>
            <div class="image-content @(i % 2 == 0 ? "left" : "right")">
                <div class="article-image">
                    @if (article.Image is not null)
                    {
                        <img src="@article.Image" loading="lazy" alt="@article.Title">
                    }
                </div>
            </div>
        </div>
        <div class="article-content @(i % 2 == 0 ? null : "reverse")">
            <div class="text-container">
                @if (article.Permission.Type == ContentType.Premium)
                {
                    <MudText Typo="Typo.body2" Color="Color.Warning">
                        @article.Permission.Type
                    </MudText>
                }

                @if (article.Permission.IsAllowed)
                {
                    <MudLink Typo="Typo.h4" Href="@(Links.History.Article(article.Id))">
                        @article.Title
                    </MudLink>
                }
                else
                {
                    <a href="#"
                       class="mud-typography mud-link mud-primary-text mud-link-underline-hover mud-typography-h4"
                       @onclick:preventDefault="true"
                       @onclick="@OnPremiumClick">
                        @article.Title
                    </a>
                }

                <MudText Typo="Typo.subtitle1">
                    @article.Overview
                </MudText>

                <div class="d-flex flex-row align-center flex-wrap">
                    <ContentRatingIcon Rating="@article.Rating"/>
                    @if (article.CompletedTimes is not null)
                    {
                        @if (article.CompletedTimes.Success > 0)
                        {
                            <div class="d-flex flex-row align-center">
                                <MudIcon Icon="@(Icons.Filled.PanoramaFishEye)" Class="mx-2" Style="width: 8px; height: 8px"/>
                                <MudText Typo="Typo.body2">
                                    <em>
                                        @L["Test:PassedTimes", article.CompletedTimes.Success.ToReadable()]
                                    </em>
                                </MudText>
                            </div>
                        }

                        @if (article.CompletedTimes.Fail > 0)
                        {
                            <div class="d-flex flex-row align-center">
                                <MudIcon Icon="@(Icons.Filled.PanoramaFishEye)" Class="mx-2" Style="width: 8px; height: 8px"/>
                                <MudText Typo="Typo.body2">
                                    <em>
                                        @L["Test:NotPassedTimes", article.CompletedTimes.Fail.ToReadable()]
                                    </em>
                                </MudText>
                            </div>
                        }
                    }
                </div>
            </div>
        </div>
    </div>
}

@code {

    [Parameter]
    public HistoryArticleSummary[] Articles { get; set; } = default!;

    [Parameter]
    public EventCallback OnPremiumClick { get; set; }

}
